## 02-HTTPS/TCP协议

### 一、什么是HTTPS

- HTTP是通过明文方式传递数据的，容易导致数据泄露、数据篡改、流量劫持、钓鱼攻击等安全性问题，HTTP协议中的请求和响应不会对通信方进行确认。
- HTTPS是在HTTP上建立SSL加密层，并对传输数据进行加密，是HTTP协议的安全版。

**HTTPS的作用**

1. 对数据加密，建立一个信息安全通道，保证传输过程中数据的安全
2. 对内容传输进行完成性校验
3. 对网站服务器进行真实身份认证

### 二、HTTPS如何对数据加密

- 通常HTTP直接和TCP通信，而HTTPS会让HTTP先和SSL通信，再由SSL和TCP通信，在采用SSL后，HTTP就拥有了HTTPS的加密、证书和完整性保护这些功能
- HTTPS 协议的主要功能基本都依赖于 TLS/SSL 协议，TLS/SSL 的功能实现主要依赖于三类基本算法：散列函数 、对称加密和非对称加密，
  - **其利用非对称加密实现身份认证和密钥协商**
  - **对称加密算法采用协商的密钥对数据加密**
  - **基于散列函数验证信息的完整性**
- 对称秘钥：
  - 服务器向客户端发送一份加密过的数据，同时发送秘钥
  - 客户端通过秘钥对数据进行解密
- 非对称秘钥
  - 服务器向客户端发送一份用私钥加密过的数据
  - 客户端用公钥进行解密
  - 公钥所有人都有，私钥只有服务器才有，可以保证服务器发的内容不能被伪造
  - 同时客户端可以用公钥对数据进行加密，此时只有服务器才能通过私钥解密看到原文
  - 公钥加密的内容只有私钥可以解开，私钥加密的内容公钥可以解开（私钥只保存在服务端）
  - 公钥由权威机构发布，内置在浏览器中，若服务器发过来的公钥被串改，则客户端不能识别该公钥，匹配便会失败
- HTTPS就是使用SSL/TLS协议进行加密传输，让客户端拿到服务器的公钥，客户端通过内置的公钥数字认证后，随机生成一个对称秘钥，使用服务器的公钥对对称秘钥进行加密，传输给服务器，服务器可以通过私钥对对称秘钥解密，后续的所有信息都通过该对称秘钥进行加密解密，完成整个HTTPS的流程。

### 三、TCP协议

- TCP/IP协议是internet中最基本的协议，http是它的子集，TCP/IP协议按层次可分为应用层、传输层（TCP协议，UDP协议）、网络层、链路层。
- tcp如何保证数据的可靠性
  - 分块传送：数据被分割成最合适的数据块（UDP的数据报长度不变）
  - 等待确认：通过定时器等待接收端发送确认请求，收不到确认则重发
  - 确认回复：收到确认后发送确认回复（不是立即发送，通常推迟几分之一秒）
  - 数据校验：保持首部和数据的校验，检测数据传输过程有无变化
  - 乱序排序：接收端能重排序数据，以正确的顺序交给应用端
  - 重复丢弃：接收端能丢弃重复的数据包
  - 流量缓冲：两端有固定大小的缓冲区（滑动窗口），防止速度不匹配丢数据
- 标识位说明
  - URG：为1时，表示紧急指针有效
  - ACK：确认标识，连接建立成功后，总为1，为1时确认号有效
  - PSH：接收方应尽快把这个报文交给应用层
  - RST：复位标识，重建连接
  - SYN：建立新连接时，该为0
  - FIN：关闭连接标识

- 三次握手建立连接
  - 客户端发送SYN，表明要向服务器建立连接，同时带上序列号ISN
  - 服务器收到后。返回ACK（序号为客户端序列号+1）作为确认，同时发送SYN作为应答（SYN的序列号为服务端唯一的序号）
  - 客户端发送ACK确认收到回复（序列号为服务端序列号+1）
- 为什么是三次握手？
  - TCP连接是双向的，要确保双方同时能发送数据和接收数据
  - 第一次握手：证明了发送方能发送数据
  - 第二次握手：ack确保了接收方能接收数据，SYN确保了接收方能发数据
  - 第三次握手：确保了发送方能接收数据
  - 四次握手会造成连接过程中性能的浪费，两次握手不能保证双方同时具备接收和发送数据的能力
- 四次挥手断开连接
  - 客户端发送FIN表示要关闭数据连接
  - 服务端收到FIN后，发送ACK作为确认（序列号为收到的序列号+1）
  - 等服务器数据传输完毕，也发送一个FIN标识，表示关闭这个方向的数据传输
  - 客户端回复ACK确认回复
- 为什么是四次挥手
  - tcp连接是双向的，需要保证数据在两个方向上能同时传递
  - 同时tcp支持半关闭（发送一方结束发送还能接收数据）
  - 因此每个方向都要单独关闭，且收到关系通知需要发送确认回复