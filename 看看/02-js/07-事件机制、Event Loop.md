## 07-事件机制、Event Loop

- JavaScript是一门单线程语言，所有的JavaScript版多线程都是用单线程模拟出来的

### 一、宏任务与微任务

- MacroTask（宏任务）：
  - script全部代码、setTimeout、setInterval、I/O、UI Rendering
- MicroTask (微任务)
  - promise、asyn await
- JavaScript有一个main  thread 主线程和call-stack调用栈（执行栈），所有的任务都会被放到调用栈等待主线程执行
- JS调用栈
  - JS调用栈采用的是后进先出的规则，当函数执行的时候，会被添加到栈的顶部，当执行栈执行完成后，就会从栈顶移出，直到栈内被清空

### 二、同步任务和异步任务

- JavaScript单线程任务被分为同步任务和异步任务
- 同步任务会在调用栈中按照顺序等待主线程依次执行
- 异步任务会在异步任务有了结果后，将注册的回调函数放入任务队列中等待主线程空闲的时候（调用栈被清空），被读取到栈内等待主线程的执行

### 三、事件循环的进程模型

- 选择当前要执行的任务队列，选择任务队列中最先进入的任务，如果任务队列为空即null，则跳转到微任务的执行步骤
- 将事件循环中的任务设置为已选择任务
- 执行任务
- 将事件循环中当前运行任务设置为null
- 将已经运行完成的任务从任务队列中删除
- microtasks步骤：进入microtask检查点
- 更新页面渲染。
- 返回第一步



- 执行栈在执行完同步任务后，查看执行栈是否为空，如果执行栈为空，则去检查微任务队列是否为空，如果为空就执行宏任务，否则就一次性执行完所有微任务。
- 每次单个宏任务执行完毕后，检查微任务队列是否为空，如果不为空的话，会按照先入先出的规则全部执行完微任务，设置微任务队列为null，然后再执行宏任务，如此循环

### 四、总结

- JavaScript是单线程语言
- JavaScript的任务被分为宏任务和微任务，
  - 宏任务包含srcipt的代码和setTimeout、setInterval等
  - setTimeout、setInterval相当于第二次宏任务，会在第一次宏任务和微任务执行结束后执行
  - 微任务包含promise等
- 事件循环过程
  - 在js主线程中，将宏任务按照顺序队列的方式一次执行，执行完毕后会查看微任务队列是否为空，若不为空则按照队列的规则执行完微任务，然后再执行宏任务（setTimeout），最后清空宏任务，和JS调用栈

